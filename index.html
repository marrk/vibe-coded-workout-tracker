<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jelmer Says Gym Tracker</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: white; padding: 15px; max-width: 500px; margin: auto; }
        #start-screen { display: flex; flex-direction: column; justify-content: center; height: 85vh; text-align: center; }
        #workout-ui { display: none; }
        
        /* Selection UI */
        select { background: #111; color: white; border: 1px solid #333; padding: 20px; border-radius: 15px; width: 100%; font-size: 1.2em; margin-bottom: 20px; text-align: center; }
        .btn-start { background: #3498db; color: white; border: none; padding: 25px; border-radius: 15px; font-size: 1.4em; font-weight: bold; }

        /* Timeline with Reps & Sets Left */
        .timeline { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; border-bottom: 1px solid #222; margin-bottom: 25px; scrollbar-width: none; }
        .step { min-width: 120px; text-align: center; font-size: 0.75em; color: #444; border: 1px solid #222; padding: 12px; border-radius: 15px; flex-shrink: 0; transition: 0.3s; }
        .step.active { color: #3498db; border-color: #3498db; background: rgba(52, 152, 219, 0.1); transform: scale(1.05); }
        .step.done { color: #27ae60; border-color: #27ae60; opacity: 0.4; }
        .info-sub { font-weight: bold; color: #888; font-size: 1.1em; margin: 4px 0; }
        .active .info-sub { color: #fff; }
.ex-gif {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 15px;
    margin-bottom: 15px;
    border: 1px solid #333;
}

        /* Controls */
        .control-row { background: #111; border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 1px solid #222; }
        .stepper { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .btn-step { background: #222; color: white; border: 1px solid #444; width: 60px; height: 60px; border-radius: 15px; font-size: 1.8em; }
        .val { font-size: 2.2em; font-weight: bold; }
        .btn-complete { background: #27ae60; color: white; border: none; width: 100%; padding: 22px; border-radius: 20px; font-size: 1.4em; font-weight: bold; margin-top: 15px; }

        /* Rest Overlay */
        #rest { position: fixed; top:0; left:0; width:100%; height:100%; background:#000; display:none; flex-direction:column; justify-content:center; align-items:center; z-index:100; }
        #timer { font-size: 9rem; font-weight: bold; color: #27ae60; font-family: monospace; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color:#3498db">GEMINI FIT</h1>
        <select id="w-select">
            <option value="workoutA">Workout A (Push & Arms)</option>
            <option value="workoutB">Workout B (Legs & Back)</option>
        </select>
        <button class="btn-start" onclick="begin()">START SESSION</button>
    </div>

    <div id="workout-ui">
        <div id="tl" class="timeline"></div>
        <img id="ex-gif" class="ex-gif" src="" alt="exercise-demo">
        <div style="text-align: center; margin-bottom: 20px;">
            <div id="ex-title" style="font-size: 1.8em; font-weight: bold;">--</div>
            <div id="set-count" style="color:#666; text-transform:uppercase; letter-spacing:1px;">SET 1 OF 4</div>
        </div>

        <div class="control-row">
            <span style="color:#666; font-size:0.8em">WEIGHT (KG)</span>
            <div class="stepper">
                <button class="btn-step" onclick="adj('w',-2.5)">-</button>
                <div class="val" id="v-w">0</div>
                <button class="btn-step" onclick="adj('w',2.5)">+</button>
            </div>
        </div>

        <div class="control-row">
            <span style="color:#666; font-size:0.8em">REPS</span>
            <div class="stepper">
                <button class="btn-step" onclick="adj('r',-1)">-</button>
                <div class="val" id="v-r">0</div>
                <button class="btn-step" onclick="adj('r',1)">+</button>
            </div>
        </div>

        <div class="control-row">
            <span style="color:#666; font-size:0.8em">RPE</span>
            <div class="stepper">
                <button class="btn-step" onclick="adj('e',-1)">-</button>
                <div class="val" id="v-e">8</div>
                <button class="btn-step" onclick="adj('e',1)">+</button>
            </div>
        </div>

        <button class="btn-complete" onclick="nextSet()">FINISH SET</button>
    </div>

    <div id="rest">
        <div id="timer">90</div>
        <button onclick="skipRest()" style="background:none; border:1px solid #444; color:#666; padding:15px 40px; border-radius:30px; margin-top:30px;">SKIP REST</button>
    </div>

    <script>
        let exIdx = 0, setIdx = 0, activeW = [], data = null;

        async function begin() {
            const res = await fetch('workouts.json');
            data = await res.json();
            activeW = data[document.getElementById('w-select').value];
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('workout-ui').style.display = 'block';
            draw();
        }

        function draw() {
            const ex = activeW[exIdx];
            const sch = data.schemes[ex.scheme];
            const step = sch[setIdx];
            const rm = parseFloat(localStorage.getItem(`rm_${ex.id}`)) || ex.rm;
            // Set the GIF source
            document.getElementById('ex-gif').src = ex.gif;
            document.getElementById('ex-title').innerText = ex.name;
            document.getElementById('set-count').innerText = `Set ${setIdx+1} of ${sch.length}`;
            document.getElementById('v-w').innerText = (rm * step.pct).toFixed(1);
            document.getElementById('v-r').innerText = step.reps;

            const tl = document.getElementById('tl');
            tl.innerHTML = activeW.map((item, i) => {
                const sLen = data.schemes[item.scheme].length;
                let status = i < exIdx ? 'done' : (i === exIdx ? 'active' : '');
                let detail = i < exIdx ? 'âœ“' : (i === exIdx ? `${sLen - setIdx} LEFT` : `${sLen} SETS`);
                let reps = `${data.schemes[item.scheme][0].reps} REPS`;
                
                return `<div class="step ${status}">
                    <div style="font-weight:bold">${item.name}</div>
                    <div class="info-sub">${reps}</div>
                    <div style="color:#555">${detail}</div>
                </div>`;
            }).join('');
            
            const active = document.querySelector('.step.active');
            if(active) active.scrollIntoView({behavior:'smooth', inline:'center'});
        }

        function adj(t, a) {
            const el = document.getElementById(`v-${t}`);
            let v = parseFloat(el.innerText);
            v = Math.max(0, v + a);
            el.innerText = t === 'w' ? v.toFixed(1) : Math.round(v);
        }

        function nextSet() {
            const ex = activeW[exIdx];
            const sch = data.schemes[ex.scheme];
            const rpe = parseInt(document.getElementById('v-e').innerText);

            if (setIdx === sch.length - 1 && rpe <= 7) {
                const currRM = parseFloat(localStorage.getItem(`rm_${ex.id}`)) || ex.rm;
                localStorage.setItem(`rm_${ex.id}`, currRM + 2.5);
            }

            if (setIdx < sch.length - 1) { setIdx++; } 
            else { exIdx++; setIdx = 0; }

            if (exIdx < activeW.length) { startT(); draw(); } 
            else { document.body.innerHTML = "<h1 style='text-align:center; margin-top:100px;'>Session Complete! ðŸ”¥</h1>"; }
        }

        let clock;
        function startT() {
            document.getElementById('rest').style.display = 'flex';
            let s = 90;
            document.getElementById('timer').innerText = s;
            clock = setInterval(() => {
                s--; document.getElementById('timer').innerText = s;
                if(s <= 0) skipRest();
            }, 1000);
        }
        function skipRest() { clearInterval(clock); document.getElementById('rest').style.display = 'none'; }
    </script>
</body>
</html>
