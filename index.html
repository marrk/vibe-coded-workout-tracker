<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <title>Elite Gym Partner</title>
    <style>
        :root { --blue: #3498db; --green: #27ae60; --bg: #000; --card: #111; --text-dim: #666; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: white; padding: 15px; max-width: 500px; margin: auto; touch-action: manipulation; }
        
        .header-controls { display: flex; gap: 8px; margin-bottom: 15px; }
        select { background: #111; color: white; border: 1px solid #333; padding: 12px; border-radius: 10px; flex: 2; font-size: 0.9rem; }
        .toggle-group { display: flex; background: #222; border-radius: 10px; padding: 3px; flex: 2; border: 1px solid #333; }
        .toggle-btn { flex: 1; border: none; background: none; color: #666; padding: 10px 5px; font-size: 0.7rem; font-weight: bold; border-radius: 8px; text-transform: uppercase; }
        .toggle-btn.active { background: var(--blue); color: white; }

        .timeline { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 15px; margin-bottom: 15px; scrollbar-width: none; border-bottom: 1px solid #222; }
        .step { min-width: 100px; text-align: center; font-size: 0.65em; color: #444; border: 1px solid #222; padding: 10px; border-radius: 12px; flex-shrink: 0; }
        .step.active { color: var(--blue); border-color: var(--blue); background: rgba(52, 152, 219, 0.1); }
        .step.done { color: var(--green); border-color: var(--green); opacity: 0.5; }
        .step-sets { display: block; font-weight: bold; margin-top: 4px; color: #888; }

        .card { background: var(--card); border-radius: 24px; padding: 20px; border: 1px solid #333; position: relative; overflow: hidden; }
        .ex-image-container { width: calc(100% + 40px); margin: -20px -20px 20px -20px; height: 160px; background: #222; }
        .ex-image-container img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .ten-rm-badge { position: absolute; top: 150px; right: 20px; background: #f1c40f; color: #000; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.75rem; z-index: 10; }

        .stepper-container { margin-bottom: 15px; }
        .stepper-label { text-align: center; color: var(--text-dim); font-size: 0.7rem; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        .stepper-controls { display: flex; align-items: center; justify-content: space-between; background: #000; border-radius: 15px; padding: 4px; border: 1px solid #222; }
        .step-btn { width: 50px; height: 50px; border-radius: 12px; border: none; background: #222; color: white; font-size: 1.4rem; }
        .step-value { font-size: 1.6rem; font-weight: bold; width: 90px; text-align: center; }

        .btn-complete { background: var(--green); color: white; border: none; padding: 20px; width: 100%; border-radius: 16px; font-weight: bold; font-size: 1.2rem; margin-top: 10px; }
        
        #timer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #timer-display { font-size: 10rem; font-weight: bold; color: var(--green); }
        .btn-skip { background: transparent; border: 2px solid #333; color: #888; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; margin-top: 30px; }
    </style>
</head>
<body>

    <div class="header-controls">
        <select id="workoutSelect" onchange="initWorkout()">
            <option value="pushA">Push A</option>
            <option value="pullA">Pull A</option>
            <option value="pushB">Push B</option>
            <option value="pullB">Pull B</option>
        </select>
        <div class="toggle-group">
            <button id="mode-free" class="toggle-btn active" onclick="setMode('free')">Free</button>
            <button id="mode-mach" class="toggle-btn" onclick="setMode('mach')">Mach</button>
        </div>
    </div>

    <div id="timeline-container" class="timeline"></div>
    <div id="focus-area">
        <div class="card">
            <div class="ex-image-container"><img id="ex-img" src="" alt=""></div>
            <div class="ten-rm-badge">10RM: <span id="val-10rm">0</span>kg</div>
            <h2 id="ex-name" style="text-align:center; color:var(--blue); margin-top:0;"></h2>
            <div id="set-counter" style="text-align:center; font-size:0.7rem; color:#888; margin-bottom:15px;"></div>

            <div class="stepper-container">
                <div class="stepper-label">Weight</div>
                <div class="stepper-controls">
                    <button class="step-btn" onclick="adjust('w', -2.5)">‚àí</button>
                    <div class="step-value" id="val-w">0</div>
                    <button class="step-btn" onclick="adjust('w', 2.5)">+</button>
                </div>
            </div>

            <div class="stepper-container">
                <div class="stepper-label">Reps</div>
                <div class="stepper-controls">
                    <button class="step-btn" onclick="adjust('r', -1)">‚àí</button>
                    <div class="step-value" id="val-r">0</div>
                    <button class="step-btn" onclick="adjust('r', 1)">+</button>
                </div>
            </div>

            <div class="stepper-container">
                <div class="stepper-label">RPE</div>
                <div class="stepper-controls">
                    <button class="step-btn" onclick="adjust('e', -1)">‚àí</button>
                    <div class="step-value" id="val-e">8</div>
                    <button class="step-btn" onclick="adjust('e', 1)">+</button>
                </div>
            </div>
            <button class="btn-complete" onclick="completeSet()">LOG & REST</button>
        </div>
    </div>

    <div id="timer-overlay">
        <div id="timer-display">90</div>
        <button class="btn-skip" onclick="stopRest()">SKIP REST</button>
    </div>

    <script>
        const workoutData = {
            pushA: [
                { id: "pA1", free: "Barbell Bench Press", mach: "Machine Chest Press", sets: 3, rMin: 8, rMax: 10, wF: 35, wM: 45 },
                { id: "pA2", free: "Incline DB Press", mach: "Smith Machine Incline", sets: 3, rMin: 10, rMax: 12, wF: 15, wM: 35 },
                { id: "pA3", free: "DB Shoulder Press", mach: "Machine Shoulder Press", sets: 3, rMin: 10, rMax: 12, wF: 12.5, wM: 30 },
                { id: "pA4", free: "DB Flat Flys", mach: "Pec Deck Fly", sets: 3, rMin: 12, rMax: 15, wF: 10, wM: 30 },
                { id: "pA5", free: "DB Lateral Raise", mach: "Cable Side Raise", sets: 3, rMin: 15, rMax: 20, wF: 8, wM: 5 }
            ],
            pullA: [
                { id: "plA1", free: "DB Lat Pullover", mach: "Lat Pulldown", sets: 3, rMin: 8, rMax: 12, wF: 17.5, wM: 40 },
                { id: "plA2", free: "Bent Barbell Row", mach: "Seated Cable Row", sets: 3, rMin: 10, rMax: 12, wF: 35, wM: 40 },
                { id: "plA3", free: "Face Pulls", mach: "Reverse Pec Deck", sets: 3, rMin: 15, rMax: 20, wF: 15, wM: 25 },
                { id: "plA4", free: "DB Shrugs", mach: "Machine Shrugs", sets: 3, rMin: 12, rMax: 15, wF: 20, wM: 40 },
                { id: "plA5", free: "Barbell Curls", mach: "Preacher Machine", sets: 3, rMin: 10, rMax: 12, wF: 15, wM: 20 }
            ],
            pushB: [
                { id: "pB1", free: "Standing BB Press", mach: "Shoulder Press Machine", sets: 3, rMin: 8, rMax: 10, wF: 30, wM: 35 },
                { id: "pB2", free: "Low-to-High Cables", mach: "Incline Machine Press", sets: 3, rMin: 12, rMax: 15, wF: 7.5, wM: 30 },
                { id: "pB3", free: "Lean Lateral Raise", mach: "Machine Lateral Raise", sets: 4, rMin: 12, rMax: 15, wF: 8, wM: 20 },
                { id: "pB4", free: "Skull Crushers", mach: "Cable Tricep Pushdown", sets: 3, rMin: 10, rMax: 12, wF: 15, wM: 15 },
                { id: "pB5", free: "Weighted Push-Ups", mach: "Chest Press (Light)", sets: 2, rMin: 15, rMax: 20, wF: 0, wM: 30 }
            ],
            pullB: [
                { id: "plB1", free: "One-arm DB Row", mach: "T-Bar Row Machine", sets: 3, rMin: 8, rMax: 10, wF: 20, wM: 35 },
                { id: "plB2", free: "Straight Arm Pullover", mach: "Close Grip Pulldown", sets: 3, rMin: 12, rMax: 15, wF: 12.5, wM: 35 },
                { id: "plB3", free: "Barbell Deadlift", mach: "Back Extension Machine", sets: 3, rMin: 8, rMax: 10, wF: 40, wM: 40 },
                { id: "plB4", free: "DB Rear Delt Flys", mach: "Cable Face Pulls", sets: 3, rMin: 15, rMax: 20, wF: 8, wM: 15 },
                { id: "plB5", free: "DB Hammer Curls", mach: "Cable Hammer Curls", sets: 3, rMin: 12, rMax: 15, wF: 10, wM: 10 }
            ]
        };

        let currentExIdx = 0, currentSetIdx = 1, currentMode = 'free', curW, curR, curE, restTimer;

        function setMode(m) { currentMode = m; document.getElementById('mode-free').className = m === 'free' ? 'toggle-btn active' : 'toggle-btn'; document.getElementById('mode-mach').className = m === 'mach' ? 'toggle-btn active' : 'toggle-btn'; initWorkout(); }
        
        function initWorkout() { const k = document.getElementById('workoutSelect').value; workoutList = workoutData[k] || []; currentExIdx = 0; currentSetIdx = 1; updateUI(); }

        function updateUI() {
            const ex = workoutList[currentExIdx];
            if (!ex) { document.getElementById('focus-area').innerHTML = "<h1 style='text-align:center;'>Done! üèÜ</h1>"; return; }
            const name = currentMode === 'free' ? ex.free : ex.mach;
            document.getElementById('ex-name').innerText = name;
            document.getElementById('set-counter').innerText = `Set ${currentSetIdx} of ${ex.sets}`;
            document.getElementById('ex-img').src = `https://loremflickr.com/500/300/gym,${name.split(' ').pop()}`;
            document.getElementById('timeline-container').innerHTML = workoutList.map((item, idx) => `<div class="step ${idx < currentExIdx ? 'done' : (idx === currentExIdx ? 'active' : '')}">${(currentMode === 'free' ? item.free : item.mach).split(' ')[0]}<span class="step-sets">${item.sets} Sets</span></div>`).join('');
            curW = parseFloat(localStorage.getItem(`w_${ex.id}_${currentMode}`)) || (currentMode === 'free' ? ex.wF : ex.wM);
            curR = ex.rMin; curE = 8; updateDisplays();
        }

        function adjust(t, a) { if(t==='w')curW=Math.max(0,curW+a); if(t==='r')curR=Math.max(1,curR+a); if(t==='e')curE=Math.max(1,Math.min(10,curE+a)); updateDisplays(); }
        function updateDisplays() { document.getElementById('val-w').innerText = curW; document.getElementById('val-r').innerText = curR; document.getElementById('val-e').innerText = curE; document.getElementById('val-10rm').innerText = (curW / (1.0278 - (0.0278 * curR)) * 0.75).toFixed(1); }

        function completeSet() { 
            const ex = workoutList[currentExIdx];
            if (curE <= 7 && curR >= ex.rMax) localStorage.setItem(`w_${ex.id}_${currentMode}`, curW + 2.5);
            if (currentSetIdx < ex.sets) currentSetIdx++; else { currentExIdx++; currentSetIdx = 1; }
            startRest(); updateUI();
        }

        function startRest() { const o = document.getElementById('timer-overlay'); let s = 90; o.style.display = 'flex'; document.getElementById('timer-display').innerText = s; restTimer = setInterval(() => { s--; document.getElementById('timer-display').innerText = s; if(s <= 0) stopRest(); }, 1000); }
        function stopRest() { clearInterval(restTimer); document.getElementById('timer-overlay').style.display = 'none'; }

        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        initWorkout();
    </script>
</body>
</html>
