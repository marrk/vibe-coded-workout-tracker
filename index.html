<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Gym Tracker</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: white; padding: 15px; max-width: 500px; margin: auto; padding-bottom: 100px; }
        .timeline { display: flex; overflow-x: auto; gap: 8px; padding: 15px 0; margin-bottom: 30px; border-bottom: 1px solid #222; scrollbar-width: none; }
        .timeline::-webkit-scrollbar { display: none; }
        .step { min-width: 100px; text-align: center; font-size: 0.65em; color: #444; border: 1px solid #222; padding: 10px; border-radius: 8px; flex-shrink: 0; }
        .step.active { color: #3498db; border-color: #3498db; background: rgba(52, 152, 219, 0.1); }
        .step.done { color: #27ae60; border-color: #27ae60; background: rgba(39, 174, 96, 0.1); }
        .step div { font-weight: bold; margin-top: 4px; font-size: 1.1em; }
        .focus-label { text-align: center; color: #888; text-transform: uppercase; letter-spacing: 1px; font-size: 0.8em; margin-bottom: 10px; }
        .exercise-title { text-align: center; font-size: 1.8em; margin-bottom: 30px; color: #3498db; }
        .card { background: #111; border-radius: 20px; padding: 25px; border: 1px solid #333; }
        .input-row { display: flex; gap: 15px; margin: 20px 0; }
        .input-group { flex: 1; display: flex; flex-direction: column; font-size: 0.75em; color: #666; text-align: center; }
        .input-group input { background: #000; color: #fff; border: 1px solid #444; margin-top: 8px; text-align: center; font-size: 1.5em; padding: 15px 5px; border-radius: 12px; }
        .btn-done { background: #27ae60; color: white; border: none; padding: 20px; width: 100%; border-radius: 12px; font-weight: bold; font-size: 1.2em; cursor: pointer; }
        #timer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #timer-display { font-size: 8rem; font-weight: bold; color: #27ae60; }
        select { background: #111; color: white; border: 1px solid #333; padding: 10px; border-radius: 8px; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="setup-ui">
        <select id="workoutSelect" onchange="initWorkout()">
            <option value="pushA">Push A (Chest Focus)</option>
            <option value="pullA">Pull A (Width)</option>
        </select>
        <select id="equipSelect" onchange="initWorkout()">
            <option value="free">Free Weights</option>
            <option value="mach">Machines</option>
        </select>
    </div>

    <div id="timeline-container" class="timeline"></div>
    <div id="focus-area">
        <div class="focus-label" id="set-counter">SET 1</div>
        <div class="exercise-title" id="ex-name">Select Workout</div>
        <div class="card">
            <div class="input-row">
                <div class="input-group">KG<input type="number" step="0.5" id="cur-w"></div>
                <div class="input-group">REPS<input type="number" id="cur-r"></div>
                <div class="input-group">RPE<input type="number" id="cur-e" value="8"></div>
            </div>
            <button class="btn-done" onclick="completeCurrentSet()">COMPLETE SET</button>
        </div>
    </div>

    <div id="timer-overlay">
        <div id="timer-display">90</div>
        <button onclick="stopRest()" style="background:transparent; border:1px solid #444; color:#888; padding:10px 25px; margin-top:40px; border-radius:30px;">SKIP</button>
    </div>

    <script>
        let currentExIdx = 0;
        let currentSetIdx = 1; 
        let workoutList = [];
        let allWorkouts = {};

        async function initWorkout() {
            try {
                // Fetch the external JSON file
                const response = await fetch('workouts.json');
                allWorkouts = await response.json();
                
                const key = document.getElementById('workoutSelect').value;
                workoutList = allWorkouts[key] || [];
                currentExIdx = 0;
                currentSetIdx = 1;
                updateUI();
            } catch (error) {
                console.error("Error loading workouts:", error);
                alert("Could not find workouts.json. Make sure it is in the same folder.");
            }
        }

        function updateUI() {
            const ex = workoutList[currentExIdx];
            if (!ex) {
                document.getElementById('focus-area').innerHTML = "<h1>Done!</h1>";
                return;
            }

            // Get current set data (set 1, 2, 3, or 4)
            const setData = ex.sets_data[currentSetIdx - 1];
            
            // Calculate weight: (Stored 10RM or Default 10RM) * weight_percentage
            const base10RM = parseFloat(localStorage.getItem(`rm_${ex.id}`)) || ex.tenRM_base;
            const calculatedWeight = (base10RM * setData.weight_pct).toFixed(1);

            document.getElementById('ex-name').innerText = ex.name;
            document.getElementById('set-counter').innerText = `SET ${currentSetIdx} OF 4`;
            document.getElementById('cur-w').value = calculatedWeight;
            document.getElementById('cur-r').value = setData.reps;
        }

        function completeCurrentSet() {
            const ex = workoutList[currentExIdx];
            const w = parseFloat(document.getElementById('cur-w').value);
            const r = parseInt(document.getElementById('cur-r').value);
            const e = parseInt(document.getElementById('cur-e').value);
            const mode = document.getElementById('equipSelect').value;

            if (e <= 7 && r >= ex.rMax) {
                localStorage.setItem(`w_${ex.id}_${mode}`, w + 2.5);
            }

            if (currentSetIdx < ex.sets) { currentSetIdx++; } 
            else { currentExIdx++; currentSetIdx = 1; }

            startRest();
            updateUI();
        }

        let countdown;
        function startRest() {
            document.getElementById('timer-overlay').style.display = 'flex';
            let s = 90;
            document.getElementById('timer-display').innerText = s;
            countdown = setInterval(() => { 
                s--; document.getElementById('timer-display').innerText = s;
                if (s <= 0) stopRest();
            }, 1000);
        }
        function stopRest() { clearInterval(countdown); document.getElementById('timer-overlay').style.display = 'none'; }

        initWorkout();
    </script>
</body>
</html>